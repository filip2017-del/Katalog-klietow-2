// === lang.js (pełna wersja z przeładowaniem na details.html + wszystkie tłumaczenia) ===

const translations = {
  pl: {
    matcher_best: "Najlepszy wybór dla Ciebie",
    matcher_title: "Matcher",
    matcher_results: "Twoje matchy",
    matcher_restart: "Spróbuj ponownie",
    // --- Nawigacja i strona główna ---
    nav_catalog: "Katalog fryzur",
    nav_builder: "Wybierz swoją fryzurę",
    page_title: "Katalog fryzur męskich",
    filter_length: "Długość włosów",
    filter_style: "Styl",
    filter_face: "Kształt twarzy",
    filter_any: "Dowolne",
    //boki
    filter_high_fade: "Wysoki fade",
    filter_mid_fade: "Mid fade",
    filter_low_fade: "Niski fade",
    filter_burst_fade: "Burst fade",
    filter_taper: "Taper fade",
    filter_undercut: "Undercut",
    filter_tapered_3mm: "Wycieniowane od 3mm",
    filter_classic_scissors: "Klasyczne nożyczkami",
    filter_creative: "Kreatywne",

    //gora
    filter_textured: "Z teksturą",
    filter_voluminous: "Z objętością",
    filter_spiky: "Kolczasta",
    //grzywka
    filter_none: "Brak",
    filter_straight: "Prosta",
    filter_curtain: "Kurtyna (midle part)",
    filter_side: "Na boku",

    // --- Filtry: Długość ---
    filter_short: "Krótkie",
    filter_medium: "Średnie",
    filter_long: "Długie",

    // --- Filtry: Styl ---
    filter_classic: "Klasyczny",
    filter_modern: "Nowoczesny",
    filter_sport: "Sportowy",
    filter_alternative: "Alternatywny",
    filter_retro: "Retro",
    filter_natural: "Naturalny",
    filter_military: "Wojskowy",

    // --- Filtry: Kształt twarzy ---
    filter_oval: "Owalna",
    filter_round: "Okrągła",
    filter_square: "Kwadratowa",
    filter_triangle: "Trójkątna",
    filter_diamond: "Diamentowa",

    // --- Szczegóły fryzury ---
    details_length: "Długość:",
    details_style: "Styl:",
    details_face: "Kształt twarzy:",
    details_hair: "Typ włosów:",
    back_button: "Powrót do katalogu",

    // --- Builder (selektory wariantów) ---
    builder_sides: "Boki",
    builder_top: "Góra",
    builder_bangs: "Grzywka",
    builder_style: "Styl",
    builder_match: "Najlepsze dopasowanie:",
    builder_no_match: "Brak fryzur spełniających kryteria.",
    builder_view_details: "Zobacz szczegóły",

    // --- Typy włosów ---
    hair_straight: "Proste",
    hair_wavy: "Falowane",
    hair_curly: "Kręcone",


    // --- Inne ---
    loading: "Ładowanie...",
    footer: "© 2025 Katalog Fryzur Męskich"
  },
  en: {
    matcher_best: "Best match for you!",
    matcher_title: "Matcher",
    matcher_results: "Your match",
    matcher_restart: "Try again",
    nav_catalog: "Hairstyle Catalog",
    nav_builder: "Build Your Hairstyle",
    page_title: "Men's Hairstyle Catalog",
    filter_length: "Hair Length",
    filter_style: "Style",
    filter_face: "Face Shape",
    filter_any: "Any",

    filter_high_fade: "High Fade",
    filter_mid_fade: "Mid Fade",
    filter_low_fade: "Low Fade",
    filter_burst_fade: "Burst Fade",
    filter_taper: "Taper Fade",
    filter_undercut: "Undercut",
    filter_tapered_3mm: "Tapered from 3mm",
    filter_classic_scissors: "Classic with Scissors",
    filter_creative: "Creative",

    filter_short: "Short",
    filter_medium: "Medium",
    filter_long: "Long",
    filter_textured: "Textured",
    filter_voluminous: "Voluminous",
    filter_spiky: "Spiky",

    filter_none: "None",
    filter_straight: "Straight",
    filter_curtain: "Curtain",
    filter_side: "Side-parted",

    filter_classic: "Classic",
    filter_modern: "Modern",
    filter_sport: "Sporty",
    filter_alternative: "Alternative",
    filter_retro: "Retro",
    filter_natural: "Natural",
    filter_military: "Military",

    filter_oval: "Oval",
    filter_round: "Round",
    filter_square: "Square",
    filter_triangle: "Triangle",
    filter_diamond: "Diamond",

    details_length: "Length:",
    details_style: "Style:",
    details_face: "Face Shape:",
    details_hair: "Hair Type:",
    back_button: "Back to Catalog",

    builder_sides: "Sides",
    builder_top: "Top",
    builder_bangs: "Bangs",
    builder_style: "Style",
    builder_match: "Best Match:",
    builder_no_match: "No hairstyles match the criteria.",
    builder_view_details: "View Details",

    hair_straight: "Straight",
    hair_wavy: "Wavy",
    hair_curly: "Curly",

    loading: "Loading...",
    footer: "© 2025 Men's Hairstyle Catalog"
  },
  ua: {
    nav_catalog: "Каталог зачісок",
    nav_builder: "Склади свою зачіску",
    page_title: "Каталог чоловічих зачісок",
    filter_length: "Довжина волосся",
    filter_style: "Стиль",
    filter_face: "Форма обличчя",
    filter_any: "Будь-яка",

    filter_high_fade: "Високий фейд",
    filter_mid_fade: "Середній фейд",
    filter_low_fade: "Низький фейд",
    filter_burst_fade: "Burst fade",
    filter_taper: "Тейпер",
    filter_undercut: "Андеркат",
    filter_tapered_3mm: "Затінено від 3мм",
    filter_classic_scissors: "Класичні ножицями",
    filter_creative: "Креативне",

    filter_short: "Короткий",
    filter_medium: "Середній",
    filter_long: "Довгий",
    filter_textured: "Текстурований",
    filter_voluminous: "Об’ємний",
    filter_spiky: "Колючкий",

    filter_none: "Немає",
    filter_straight: "Прямий",
    filter_curtain: "Куртина",
    filter_side: "З боковим проділом",

    filter_classic: "Класичний",
    filter_modern: "Сучасний",
    filter_sport: "Спортивний",
    filter_alternative: "Альтернативний",
    filter_retro: "Ретро",
    filter_natural: "Натуральний",
    filter_military: "Військовий",

    filter_oval: "Овальна",
    filter_round: "Кругла",
    filter_square: "Квадратна",
    filter_triangle: "Трикутна",
    filter_diamond: "Діамантова",

    details_length: "Довжина:",
    details_style: "Стиль:",
    details_face: "Форма обличчя:",
    details_hair: "Тип волосся:",
    back_button: "Назад до каталогу",

    builder_sides: "Боки",
    builder_top: "Верх",
    builder_bangs: "Чубчик",
    builder_style: "Стиль",
    builder_match: "Найкращий збіг:",
    builder_no_match: "Немає зачісок за критеріями.",
    builder_view_details: "Докладніше",

    hair_straight: "Пряме",
    hair_wavy: "Хвилясте",
    hair_curly: "Кучеряве",

    loading: "Завантаження...",
    footer: "© 2025 Каталог Чоловічих Зачісок"
  }
};

let currentLang = localStorage.getItem("lang") || "pl";

function t(key) {
  return translations[currentLang][key] || key;
}

function setLanguage(lang) {
  if (lang !== currentLang && translations[lang]) {
    currentLang = lang;
    localStorage.setItem("lang", lang);
    document.documentElement.lang = lang;

    // Aktualizuj UI
    updateLanguage();

    // Powiadom inne skrypty
    window.dispatchEvent(new CustomEvent("languageChanged", { detail: lang }));

    // Przeładuj tylko stronę z detalami (opcjonalnie)
    if (window.location.pathname.includes("details.html")) {
      setTimeout(() => {
        window.location.reload();
      }, 100);
    }
  }
}

function updateLanguage() {
  // Tłumaczenie elementów z data-key
  document.querySelectorAll("[data-key]").forEach(el => {
    const key = el.getAttribute("data-key");
    if (translations[currentLang][key]) {
      el.textContent = translations[currentLang][key];
    }
  });

  // Tłumaczenie opcji w selectach (filtry)
  document.querySelectorAll("select").forEach(select => {
    for (const opt of select.options) {
      const val = opt.value.toLowerCase().trim();
      const map = {
        "": "filter_any",
        "krótkie": "filter_short", "short": "filter_short",
        "średnie": "filter_medium", "medium": "filter_medium",
        "długie": "filter_long", "long": "filter_long",
        "klasyczny": "filter_classic", "classic": "filter_classic",
        "nowoczesny": "filter_modern", "modern": "filter_modern",
        "sportowy": "filter_sport", "sporty": "filter_sport",
        "alternatywny": "filter_alternative",
        "retro": "filter_retro",
        "naturalny": "filter_natural", "natural": "filter_natural",
        "wojskowy": "filter_military", "military": "filter_military",
        "owalna": "filter_oval", "oval": "filter_oval",
        "okrągła": "filter_round", "round": "filter_round",
        "kwadratowa": "filter_square", "square": "filter_square",
        "trójkątna": "filter_triangle", "triangle": "filter_triangle",
        "diamentowa": "filter_diamond", "diamond": "filter_diamond"
      };
      if (map[val]) {
        opt.textContent = t(map[val]);
      }
    }
  });

  // Aktualizacja przycisków języka
  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === currentLang);
  });

  // Tytuł strony i footer
  const titleEl = document.querySelector("title");
  if (titleEl) titleEl.textContent = t("page_title");

  const footer = document.querySelector("footer p");
  if (footer) footer.textContent = t("footer");
}

// Inicjalizacja po załadowaniu DOM
document.addEventListener("DOMContentLoaded", () => {
  updateLanguage();

  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.addEventListener("click", () => setLanguage(btn.dataset.lang));
  });
});

// === GLOBALNE FUNKCJE TŁUMACZĄCE ===
window.translateValue = function(value, prefix) {
  if (!value) return value;
  const key = value.toString().trim().toLowerCase();
  const translationKey = `${prefix}_${key}`;
  const translated = t(translationKey);
  return translated !== translationKey ? translated : value;
};

window.translateArray = function(arr, prefix) {
  // Zabezpieczenie: jeśli arr nie jest tablicą → zwróć pusty string
  if (!Array.isArray(arr)) return "";

  // Przetłumacz i usuń puste
  const translated = arr
    .map(v => {
      if (!v) return null;
      const translated = translateValue(v.trim(), prefix);
      return translated !== `filter_${v.trim()}` ? translated : v.trim();
    })
    .filter(Boolean);

  // Zwróć połączone przecinkiem
  return translated.length > 0 ? translated.join(", ") : "";
};

// === EKSPORT GLOBALNY ===
window.t = t;
window.currentLang = () => currentLang;
window.updateLanguage = updateLanguage;
window.setLanguage = setLanguage;
window.langReady = true;